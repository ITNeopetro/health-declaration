<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neopetro Health Declaration Form</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;margin:0;padding:20px}
.container{max-width:900px;margin:auto;background:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.header{text-align:center;margin-bottom:25px}
.header img{max-width:150px;margin-bottom:10px;}
.header h1{font-size:22px;margin-bottom:5px}
.header p{font-size:13px;margin:2px 0}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #ccc;padding:8px;vertical-align:top}
th{background:#f1f3f5;text-align:center}
.yesno{display:flex;justify-content:center;gap:10px}
input,textarea,select{width:100%;padding:6px;font-size:14px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box}
textarea{min-height:50px}
.row{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:10px}
.field{flex:1;min-width:200px}
label{font-size:13px;margin-bottom:4px;display:block}
.declaration{margin-top:20px;padding:15px;border:1px solid #ccc;background:#fafafa}
.submit{text-align:center;margin-top:25px}
button{background:#0b5ed7;color:#fff;border:none;padding:12px 30px;font-size:15px;border-radius:5px;cursor:pointer}
button:hover{background:#094bb5}
.signature-box{max-width:320px;margin-top:10px}
canvas{border:1px solid #333;width:100%;height:120px;touch-action:none;}
#thankyou{display:none;text-align:center;padding:50px;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.message{margin-top:10px;font-weight:bold;}
</style>
</head>
<body>

<form id="healthForm">
<input type="hidden" name="SubmissionID" id="SubmissionID">
<input type="hidden" name="SubmittedAt" id="SubmittedAt">

<div class="container" id="formPage">

<div class="header">
<img src="NEOPETRO LOGO.png" alt="Neopetro Logo">
<h1>HEALTH DECLARATION FORM / BORANG PENGISYTIHARAN KESIHATAN</h1>
<p><strong>NEOPETRO SDN BHD (388522-D)</strong></p>
<p>Document No: NP-01-36 | Edition: 01 | Revision: 01</p>
<p>Effective Date: 01 January 2025</p>
</div>

<table>
<tr>
<th style="width:5%">No</th>
<th style="width:55%">Declaration / Pengisytiharan</th>
<th style="width:15%">Yes / No<br>Ya / Tidak</th>
<th style="width:25%">Remarks</th>
</tr>
<tr>
<td>1</td>
<td>Do you have any cough symptoms, shortness of breath / breathing difficulties, fever, sore-throat, body ache for the last few days?<br><em>Adakah anda mengalami simptom batuk, sesak nafas / kesukaran bernafas, demam, sakit tekak, sakit badan sejak beberapa hari lepas?</em></td>
<td class="yesno"><label><input type="radio" name="Q1" value="Yes" required> Yes</label><label><input type="radio" name="Q1" value="No"> No</label></td>
<td><textarea name="Q1_Remarks"></textarea></td>
</tr>
<tr>
<td>2</td>
<td>Do you ever have high blood pressure / heart attacks / diabetes / Asthma?<br><em>Adakah anda pernah mempunyai darah tinggi / sakit jantung / kencing manis / asma?</em></td>
<td class="yesno"><label><input type="radio" name="Q2" value="Yes" required> Yes</label><label><input type="radio" name="Q2" value="No"> No</label></td>
<td><textarea name="Q2_Remarks"></textarea></td>
</tr>
<tr>
<td>3</td>
<td>Do you take any form of regular medication? For what health purpose?<br><em>Adakah anda mengambil sebarang bentuk ubat? Untuk tujuan kesihatan apa?</em></td>
<td class="yesno"><label><input type="radio" name="Q3" value="Yes" required> Yes</label><label><input type="radio" name="Q3" value="No"> No</label></td>
<td><textarea name="Q3_Remarks"></textarea></td>
</tr>
<tr>
<td>4</td>
<td>When is your last tour of duty?<br><em>Bilakah tugas terakhir anda?</em></td>
<td colspan="2">From / Dari: <input type="date" name="LastDutyFrom"> To / Sehingga: <input type="date" name="LastDutyTo"></td>
</tr>
<tr>
<td>5</td>
<td>How long is your next tour of duty?<br><em>Tempoh tugas yang akan datang?</em></td>
<td colspan="2">From / Dari: <input type="date" name="NextDutyFrom"> To / Sehingga: <input type="date" name="NextDutyTo"></td>
</tr>
<tr>
<td>6</td>
<td>Name and Handphone No. of next of kin?<br><em>Nama dan No. Telefon bimbit pewaris</em></td>
<td colspan="2"><input type="text" name="NOK_Name" placeholder="Name"><br><br><input type="text" name="NOK_Phone" placeholder="Tel"></td>
</tr>
<tr>
<td>7</td>
<td>Weight / Berat badan (Kg) & Height / Ketinggian (Meter)</td>
<td colspan="2">Weight: <input type="text" name="Weight"> Height: <input type="text" name="Height"></td>
</tr>
</table>

<div class="declaration">
I hereby declare that all the information stated above is true and give consent to Neopetro for using and storing my personal data given in this form for the purpose of health monitoring prior mobilisation ONLY.<br><br>
<em>Saya dengan ini mengaku bahawa semua maklumat yang dinyatakan di atas adalah benar dan memberi kebenaran kepada Neopetro untuk menggunakan dan menyimpan data peribadi saya yang diberikan dalam borang ini untuk tujuan pemantauan kesihatan sebelum mobilisasi SAHAJA.</em>
</div>

<div class="row">
<div class="field"><label>Name / Nama *</label><input type="text" name="Name" required></div>
<div class="field"><label>Nationality / Kewarganegaraan *</label><input type="text" name="Nationality" required></div>
</div>
<div class="row">
<div class="field"><label>Date / Tarikh *</label><input type="date" name="Date" required></div>
<div class="field"><label>Designation / Jawatan</label>
<select name="Designation">
  <option value="">Select</option>
  <option value="Master">Master</option>
  <option value="Chief Officer">Chief Officer</option>
  <option value="Chief Engineer">Chief Engineer</option>
  <option value="Second Officer">Second Officer</option>
  <option value="Second Engineer">Second Engineer</option>
  <option value="Oiler">Oiler</option>
  <option value="Greaser">Greaser</option>
  <option value="Able Bodied">Able Bodied</option>
  <option value="Cook">Cook</option>
</select>
</div>
</div>

<div class="signature-box">
<label>Signature / Tandatangan *</label>
<canvas id="signature"></canvas>
<input type="hidden" name="Signature" id="signatureData" required>
</div>

<div style="text-align:center;margin-top:10px;">
<button type="button" onclick="clearSignature()">Clear Signature</button>
<br><br>
<button type="submit">Submit Health Declaration</button>
<br><br>
<button type="button" onclick="generatePDF()">Generate PDF</button>
</div>

<div class="message" id="formMessage"></div>

</div>
</form>

<div id="thankyou">
<h2>Form Submitted Successfully</h2>
<p>Your health declaration has been submitted and recorded. Respective department will be notified.</p>
<button onclick="location.reload()">Close</button>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
emailjs.init("e11xX_5IIA36HGfyg"); // your public key

// Signature capture
const canvas = document.getElementById('signature');
const ctx = canvas.getContext('2d');
let drawing = false;
function resizeCanvas() {
  const ratio = Math.max(window.devicePixelRatio || 1, 1);
  canvas.width = canvas.offsetWidth * ratio;
  canvas.height = canvas.offsetHeight * ratio;
  ctx.scale(ratio, ratio);
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

canvas.addEventListener('mousedown',()=>drawing=true);
canvas.addEventListener('mouseup',()=>{drawing=false;ctx.beginPath();});
canvas.addEventListener('mouseout',()=>{drawing=false;ctx.beginPath();});
canvas.addEventListener('mousemove',draw);

canvas.addEventListener('touchstart',(e)=>{e.preventDefault();drawing=true;const touch=e.touches[0];const rect=canvas.getBoundingClientRect();ctx.moveTo(touch.clientX-rect.left,touch.clientY-rect.top);});
canvas.addEventListener('touchmove',(e)=>{e.preventDefault();if(!drawing)return;const touch=e.touches[0];const rect=canvas.getBoundingClientRect();ctx.lineWidth=2;ctx.lineCap='round';ctx.lineTo(touch.clientX-rect.left,touch.clientY-rect.top);ctx.stroke();ctx.beginPath();ctx.moveTo(touch.clientX-rect.left,touch.clientY-rect.top);});
canvas.addEventListener('touchend',()=>{drawing=false;ctx.beginPath();});

function draw(e){if(!drawing)return;ctx.lineWidth=2;ctx.lineCap='round';ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);}
function clearSignature(){ctx.clearRect(0,0,canvas.width,canvas.height);}

// Form submission
document.getElementById('healthForm').addEventListener('submit', function(e){
  e.preventDefault();
  const now=new Date();
  document.getElementById('SubmissionID').value='HD-NP01-'+now.getFullYear()+String(now.getMonth()+1).padStart(2,'0')+String(now.getDate()).padStart(2,'0')+'-'+String(now.getHours()).padStart(2,'0')+String(now.getMinutes()).padStart(2,'0')+String(now.getSeconds()).padStart(2,'0');
  document.getElementById('SubmittedAt').value=now.toLocaleString();
  document.getElementById('signatureData').value=canvas.toDataURL();

  emailjs.send("service_zdyjwv1","template_vsfdta8",Object.fromEntries(new FormData(this)))
  .then(()=>{
    document.getElementById('formPage').style.display='none';
    document.getElementById('thankyou').style.display='block';
  }).catch(err=>{
    const msg=document.getElementById('formMessage');
    msg.style.color='red';
    msg.textContent='Failed to send email. Please try again.';
    console.error("EmailJS error:",err);
  });
});

// Generate PDF
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const form = document.getElementById('formPage');
  html2canvas(form).then(canvasImg=>{
    const imgData=canvasImg.toDataURL('image/png');
    const pdf=new jsPDF('p','pt','a4');
    const pdfWidth=pdf.internal.pageSize.getWidth();
    const pdfHeight=(canvasImg.height * pdfWidth)/canvasImg.width;
    pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
    pdf.save('Neopetro_Health_Declaration.pdf');
  });
}
</script>

</body>
</html>
