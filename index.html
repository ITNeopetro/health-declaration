<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neopetro Health Declaration Form</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;margin:0;padding:20px}
.container{max-width:900px;margin:auto;background:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.header{text-align:center;margin-bottom:25px}
.header img{max-width:150px;margin-bottom:10px;}
.header h1{font-size:22px;margin-bottom:5px}
.header p{font-size:13px;margin:2px 0}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #ccc;padding:8px;vertical-align:top}
th{background:#f1f3f5;text-align:center}

.yesno{display:flex;justify-content:center;gap:12px;align-items:center;}
.yesno label{display:flex;align-items:center;gap:4px;font-size:13px;}
.yesno input[type="radio"]{width:14px;height:14px;}

input, textarea, select{width:100%;height:38px;padding:6px 8px;font-size:14px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;}
textarea{min-height:60px;height:auto}
label{font-size:13px;margin:4px 0;display:block}
.declaration{margin-top:20px;padding:15px;border:1px solid #ccc;background:#fafafa}
.row{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:12px;}
.field{flex:1;min-width:220px}
.field.ic{max-width:300px}
button{background:#f8c400;color:#000;border:none;padding:12px 30px;font-size:15px;border-radius:5px;cursor:pointer;}
button:hover{background:#e6b800}
.signature-box{max-width:320px;margin-top:15px}
/* Improved canvas styling for mobile responsiveness */
canvas{border:1px solid #333; width:100%; height:150px; touch-action:none; background: #fff; display: block;}
#thankyou{display:none;text-align:center;padding:50px;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.message{margin-top:10px;font-weight:bold;}
</style>
</head>

<body>

<form id="healthForm">

<div class="container" id="formPage">

<div class="header">
<img src="NEOPETRO LOGO.png" alt="Neopetro Logo">
<h1>HEALTH DECLARATION FORM / BORANG PENGISYTIHARAN KESIHATAN</h1>
<p><strong>NEOPETRO SDN BHD (388522-D)</strong></p>
<p>Document No: NP-01-36 | Edition: 01 | Revision: 01</p>
<p>Effective Date: 01 January 2025</p>
</div>

<table>
<tr>
<th style="width:5%">No</th>
<th style="width:55%">Declaration / Pengisytiharan</th>
<th style="width:15%">Yes / No<br>Ya / Tidak</th>
<th style="width:25%">Remarks</th>
</tr>

<tr>
<td>1</td>
<td>Do you have any cough symptoms, shortness of breath / breathing difficulties, fever, sore-throat, body ache for the last few days?<br><em>Adakah anda mengalami simptom batuk, sesak nafas / kesukaran bernafas, demam, sakit tekak, sakit badan sejak beberapa hari lepas?</em></td>
<td class="yesno">
<label><input type="radio" name="Q1" value="Yes" required>Yes</label>
<label><input type="radio" name="Q1" value="No">No</label>
</td>
<td><textarea name="Q1_Remarks"></textarea></td>
</tr>

<tr>
<td>2</td>
<td>Do you ever have high blood pressure / heart attacks / diabetes / Asthma?<br><em>Adakah anda pernah mempunyai darah tinggi / sakit jantung / kencing manis / asma?</em></td>
<td class="yesno">
<label><input type="radio" name="Q2" value="Yes" required>Yes</label>
<label><input type="radio" name="Q2" value="No">No</label>
</td>
<td><textarea name="Q2_Remarks"></textarea></td>
</tr>

<tr>
<td>3</td>
<td>Do you take any form of regular medication? For what health purpose?<br><em>Adakah anda mengambil sebarang bentuk ubat? Untuk tujuan kesihatan apa?</em></td>
<td class="yesno">
<label><input type="radio" name="Q3" value="Yes" required>Yes</label>
<label><input type="radio" name="Q3" value="No">No</label>
</td>
<td><textarea name="Q3_Remarks"></textarea></td>
</tr>

<tr>
<td>4</td>
<td>When is your last tour of duty?<br><em>Bilakah tugas terakhir anda?</em></td>
<td colspan="2">
<label>From / Dari:</label>
<input type="date" name="LastDuty_From">
<label>To / Sehingga:</label>
<input type="date" name="LastDuty_To">
</td>
</tr>

<tr>
<td>5</td>
<td>How long is your next tour of duty?<br><em>Tempoh tugas yang akan datang?</em></td>
<td colspan="2">
<label>From / Dari:</label>
<input type="date" name="NextDuty_From">
<label>To / Sehingga:</label>
<input type="date" name="NextDuty_To">
</td>
</tr>

<tr>
<td>6</td>
<td>Name and Handphone No. of next of kin?<br><em>Nama dan No. telefon binti pewaris</em></td>
<td colspan="2">
<input type="text" name="NextOfKin_Name" placeholder="Name">
<input type="text" name="NextOfKin_Tel" placeholder="Tel">
</td>
</tr>

<tr>
<td>7</td>
<td>Weight / Berat badan (Kg) & Height / Ketinggian (Meter)</td>
<td colspan="2">
<label>Weight:</label>
<input type="text" name="Weight">
<label>Height:</label>
<input type="text" name="Height">
</td>
</tr>

</table>

<div class="declaration">
I hereby declare that all the information stated above is true and give consent to Neopetro for using and storing my personal data given in this form for the purpose of health monitoring prior mobilisation ONLY.<br><br>
<em>Saya dengan ini mengaku bahawa semua maklumat yang dinyatakan di atas adalah benar dan memberi kebenaran kepada Neopetro untuk menggunakan dan menyimpan data peribadi saya yang diberikan dalam borang ini untuk tujuan pemantauan kesihatan sebelum mobilisasi SAHAJA.</em>
</div>

<div class="row">
  <div class="field">
    <label>Name / Nama *</label>
    <input type="text" name="Name" required>
  </div>
  <div class="field">
    <label>Nationality / Kewarganegaraan *</label>
    <input type="text" name="Nationality" required>
  </div>
</div>

<div class="row">
  <div class="field ic">
    <label>IC / Passport No. *</label>
    <input type="text" name="IC_Passport" required>
  </div>
  <div class="field">
    <label>Date / Tarikh *</label>
    <input type="date" name="Date" required>
  </div>
</div>

<div class="row">
  <div class="field">
    <label>Designation / Jawatan</label>
    <select name="Designation">
      <option value="">Select</option>
      <option>Master</option>
      <option>Chief Officer</option>
      <option>Chief Engineer</option>
      <option>Second Officer</option>
      <option>Second Engineer</option>
      <option>Oiler</option>
      <option>Greaser</option>
      <option>Able Bodied</option>
      <option>Cook</option>
    </select>
  </div>
</div>

<div class="signature-box">
<label>Signature / Tandatangan *</label>
<canvas id="signature"></canvas>
<input type="hidden" name="Signature" id="signatureData" required>
</div>

<div style="text-align:center;margin-top:15px;">
<button type="button" onclick="clearSignature()">Clear Signature</button><br><br>
<button type="submit">Submit Health Declaration</button>
</div>

</div>
</form>

<div id="thankyou">
<h2>Form Submitted Successfully</h2>
<p>Your health declaration has been submitted and recorded.</p>
<button onclick="location.reload()">Close</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("e11xX_5IIA36HGfyg");

const canvas = document.getElementById('signature');
const ctx = canvas.getContext('2d');
let drawing = false;

// Function to set canvas internal resolution to match display size
function resizeCanvas() {
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    ctx.scale(ratio, ratio);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Get coordinates for both Mouse and Touch
function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    if (e.touches && e.touches.length > 0) {
        return {
            x: e.touches[0].clientX - rect.left,
            y: e.touches[0].clientY - rect.top
        };
    }
    return {
        x: e.offsetX,
        y: e.offsetY
    };
}

function startDrawing(e) {
    drawing = true;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
    e.preventDefault(); // Prevent scrolling on mobile while signing
}

function draw(e) {
    if (!drawing) return;
    const pos = getPos(e);
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    e.preventDefault();
}

function stopDrawing() {
    drawing = false;
}

// Mouse Events
canvas.addEventListener('mousedown', startDrawing);
canvas.addEventListener('mousemove', draw);
window.addEventListener('mouseup', stopDrawing);

// Touch Events (Mobile)
canvas.addEventListener('touchstart', startDrawing, { passive: false });
canvas.addEventListener('touchmove', draw, { passive: false });
canvas.addEventListener('touchend', stopDrawing);

function clearSignature(){
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

const form = document.getElementById('healthForm');

form.addEventListener('submit', function(e){
  e.preventDefault();

  // Check if canvas is empty
  const blank = document.createElement('canvas');
  blank.width = canvas.width;
  blank.height = canvas.height;
  if(canvas.toDataURL() === blank.toDataURL()){
    alert("Please provide your signature before submitting.");
    return;
  }

  document.getElementById('signatureData').value = canvas.toDataURL('image/png');

  emailjs.send("service_zdyjwv1", "template_vsfdta8", {
    Name: form.Name.value,
    Nationality: form.Nationality.value,
    IC_Passport: form.IC_Passport.value,
    Date: form.Date.value,
    Designation: form.Designation.value,
    Q1: form.Q1.value,
    Q1_Remarks: form.Q1_Remarks.value,
    Q2: form.Q2.value,
    Q2_Remarks: form.Q2_Remarks.value,
    Q3: form.Q3.value,
    Q3_Remarks: form.Q3_Remarks.value,
    LastDuty_From: form.LastDuty_From.value,
    LastDuty_To: form.LastDuty_To.value,
    NextDuty_From: form.NextDuty_From.value,
    NextDuty_To: form.NextDuty_To.value,
    NextOfKin_Name: form.NextOfKin_Name.value,
    NextOfKin_Tel: form.NextOfKin_Tel.value,
    Weight: form.Weight.value,
    Height: form.Height.value,
    Signature: document.getElementById('signatureData').value
  }).then(() => {
    document.getElementById('formPage').style.display = 'none';
    document.getElementById('thankyou').style.display = 'block';
  }, (err) => {
    alert("Failed to send email. Please try again.\n" + JSON.stringify(err));
  });
});
</script>

</body>
</html>
